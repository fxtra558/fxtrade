<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steven AI Bitunix Terminal</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* Professional Dark Theme */
        body { background-color: #0b0e11; color: #ffffff; font-family: 'Inter', sans-serif; padding-top: 30px; }
        
        /* Card Styling */
        .terminal-card { background-color: #1e2329; border: 1px solid #474d57; border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 8px 32px rgba(0,0,0,0.6); }
        
        /* Text Contrast Fixes */
        .stat-label { color: #f0b90b; font-size: 0.75rem; text-transform: uppercase; font-weight: 800; letter-spacing: 1.5px; margin-bottom: 10px; display: block; }
        .text-muted { color: #b7bdc6 !important; }
        .status-msg { color: #ffffff; font-weight: 500; }

        /* Equity Balance */
        .balance-lg { font-size: 3.5rem; color: #02c076; font-weight: 900; letter-spacing: -1px; }
        
        /* Ticker and Prices */
        .buy { color: #02c076; font-weight: bold; }
        .sell { color: #f84960; font-weight: bold; }
        .live-price { color: #47bcff; font-family: 'Courier New', Courier, monospace; font-weight: bold; font-size: 1.2rem; }
        
        /* Trade Rows */
        .trade-row { border-bottom: 1px solid #2b3139; padding: 20px 0; transition: 0.2s; }
        .trade-row:hover { background-color: #2b3139; border-radius: 8px; }
        .trade-row:last-child { border-bottom: none; }
        
        /* Badges */
        .badge-buy { background-color: #02c076; color: #0b0e11; font-weight: 900; padding: 5px 12px; }
        .badge-sell { background-color: #f84960; color: #ffffff; font-weight: 900; padding: 5px 12px; }
        .version-tag { border: 1px solid #f0b90b; color: #f0b90b; font-size: 0.65rem; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <div>
                <h1 class="mb-0" style="font-weight: 900; letter-spacing: -1.5px;">STEVEN AI <span style="color: #f0b90b;">BITUNIX</span></h1>
                <span class="version-tag">SYSTEM V4.3 SNIPER</span>
            </div>
            <div class="text-end">
                <div class="text-white small">● API STATUS: <span class="text-success">ACTIVE</span></div>
                <div class="text-white small">● RISK: <span class="text-info">0.5% PER TRADE</span></div>
            </div>
        </div>
        
        <div class="row g-4">
            <!-- Account Equity Card -->
            <div class="col-lg-5">
                <div class="terminal-card">
                    <span class="stat-label">Total Account Equity (CAD)</span>
                    <div id="balance" class="balance-lg">$10,000.00</div>
                    <div class="mt-3 pt-3 border-top border-secondary">
                        <div class="d-flex justify-content-between">
                            <span class="text-muted">Market State:</span>
                            <span class="text-success">● 24/7 LIVE</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Logic Console Card -->
            <div class="col-lg-7">
                <div class="terminal-card">
                    <span class="stat-label">Neural Logic Console (Latest Pulse)</span>
                    <div id="logs" class="row mt-2">
                        <div class="col-12 status-msg">Waiting for the robot to sync with Bitunix...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Open Trades Card -->
        <div class="terminal-card mt-4">
            <span class="stat-label">Active Bitunix Positions</span>
            <div id="trades" class="mt-2">
                <p class="status-msg text-center py-5">Scanning the order book... No setups active.</p>
            </div>
        </div>
    </div>

    <script>
        // --- !!! ACTION: PASTE YOUR UPSTASH REST KEYS HERE !!! ---
        const REDIS_URL = "https://vital-lobster-24217.upstash.io"; 
        const REDIS_TOKEN = "AV6ZAAIncDJmNDJmNTIyNjgzNjc0Mjg4YjQwZmQ4OTFmODEzY2MxMHAyMjQyMTc";

        async function updateDashboard() {
            if (REDIS_URL.includes("your-unique-url")) {
                document.getElementById('logs').innerHTML = "<div class='col-12 text-danger font-weight-bold'>CRITICAL: PASTE YOUR UPSTASH KEYS IN INDEX.HTML</div>";
                return;
            }

            try {
                const headers = { Authorization: `Bearer ${REDIS_TOKEN}` };

                // 1. Fetch Balance
                const balRes = await fetch(`${REDIS_URL}/get/balance`, { headers });
                const balData = await balRes.json();
                if (balData.result) {
                    document.getElementById('balance').innerText = `$${parseFloat(balData.result).toLocaleString(undefined, {minimumFractionDigits: 2})}`;
                }

                // 2. Fetch Logic Logs
                const logRes = await fetch(`${REDIS_URL}/get/last_scan_logs`, { headers });
                const logData = await logRes.json();
                if (logData.result) {
                    const logs = JSON.parse(logData.result);
                    document.getElementById('logs').innerHTML = Object.entries(logs).map(([coin, msg]) => 
                        `<div class="col-md-4 mb-2"><b class="text-white">${coin.split('/')[0]}:</b> <span class="text-muted ms-1">${msg}</span></div>`).join('');
                }

                // 3. Fetch Active Positions & Live P/L
                const tradeRes = await fetch(`${REDIS_URL}/lrange/open_trades/0/-1`, { headers });
                const tradeData = await tradeRes.json();
                const rawTrades = tradeData.result || [];
                
                if (rawTrades.length > 0) {
                    let html = "";
                    for (let t of rawTrades) {
                        const trade = JSON.parse(t);
                        
                        // Fetch real-time tick from Binance Public API (Instant & High Contrast)
                        const ticker = trade.symbol.replace("/", "");
                        const priceRes = await fetch(`https://api.binance.com/api/v3/ticker/price?symbol=${ticker}`);
                        const priceData = await priceRes.json();
                        const curr = parseFloat(priceData.price);

                        // Calculate P/L
                        const diff = trade.side === "BUY" ? (curr - trade.entry) : (trade.entry - curr);
                        const pl = ((diff / trade.entry) * 100).toFixed(2);
                        const color = pl >= 0 ? "text-success" : "text-danger";

                        html += `
                            <div class="trade-row d-flex justify-content-between align-items-center">
                                <div style="width: 25%;">
                                    <h4 class="mb-0 text-white">${trade.symbol}</h4>
                                    <span class="badge ${trade.side === 'BUY' ? 'badge-buy' : 'badge-sell'}">${trade.side}</span>
                                </div>
                                <div class="live-price" style="width: 25%; text-align: center;">$${curr.toLocaleString()}</div>
                                <div class="${color}" style="width: 20%; text-align: center; font-size: 1.5rem; font-weight: 900;">${pl >= 0 ? '+' : ''}${pl}%</div>
                                <div class="text-end text-muted" style="width: 30%; font-size: 0.75rem;">
                                    <div class="text-white">ENTRY: $${trade.entry}</div>
                                    <div>TARGET: $${trade.tp_2r}</div>
                                </div>
                            </div>`;
                    }
                    document.getElementById('trades').innerHTML = html;
                } else {
                    document.getElementById('trades').innerHTML = '<p class="status-msg text-center py-5">System operating within normal parameters. Awaiting momentum trigger...</p>';
                }

            } catch (err) {
                console.error("Pulse Error:", err);
            }
        }

        // Pulse update every 8 seconds
        setInterval(updateDashboard, 8000);
        updateDashboard();
    </script>
</body>
</html>
