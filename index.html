<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steven AI Sniper Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #0b0e11; color: #d9d9d9; font-family: sans-serif; padding-top: 50px; }
        .terminal-card { background-color: #161a1e; border: 1px solid #2b2f36; border-radius: 12px; padding: 25px; margin-bottom: 20px; }
        .stat-label { color: #848e9c; font-size: 0.75rem; text-transform: uppercase; }
        .balance-lg { font-size: 2.8rem; color: #02c076; font-weight: bold; }
        .buy { color: #02c076; font-weight: bold; }
        .sell { color: #f84960; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h2 class="mb-4">STEVEN AI SNIPER <small class="text-muted" style="font-size: 12px;">LIVE MONITOR</small></h2>
        
        <div class="row g-4">
            <div class="col-md-4">
                <div class="terminal-card">
                    <span class="stat-label">Total CAD Equity</span>
                    <div id="balance" class="balance-lg">$0.00</div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="terminal-card">
                    <span class="stat-label">AI Logic Console (Last Scan)</span>
                    <div id="logs" class="row mt-2" style="font-size: 13px;">Connecting to database...</div>
                </div>
            </div>
        </div>

        <div class="terminal-card mt-4">
            <span class="stat-label">Open OANDA Positions</span>
            <div id="trades" class="mt-3">
                <p class="text-muted">Loading active trades...</p>
            </div>
        </div>
    </div>

    <script>
        // --- 1. PASTE YOUR UPSTASH KEYS HERE ---
        const REDIS_URL = "PASTE_YOUR_UPSTASH_REST_URL";
        const REDIS_TOKEN = "PASTE_YOUR_UPSTASH_REST_TOKEN";

        async function updateUI() {
            try {
                const headers = { Authorization: `Bearer ${REDIS_TOKEN}` };

                // A. Fetch Balance
                const balRes = await fetch(`${REDIS_URL}/get/balance`, { headers });
                const balData = await balRes.json();
                document.getElementById('balance').innerText = `$${parseFloat(balData.result || 10000).toLocaleString()}`;

                // B. Fetch Logs
                const logRes = await fetch(`${REDIS_URL}/get/last_scan_logs`, { headers });
                const logData = await logRes.json();
                const logs = JSON.parse(logData.result || "{}");
                document.getElementById('logs').innerHTML = Object.entries(logs).length 
                    ? Object.entries(logs).map(([s, l]) => `<div class="col-6"><b>${s}:</b> ${l}</div>`).join('')
                    : "Waiting for scheduled pulse...";

                // C. Fetch Open Trades
                const tradeRes = await fetch(`${REDIS_URL}/lrange/open_trades/0/-1`, { headers });
                const tradeData = await tradeRes.json();
                const trades = (tradeData.result || []).map(t => JSON.parse(t));
                
                document.getElementById('trades').innerHTML = trades.length ? trades.map(t => `
                    <div class="p-3 border-bottom border-secondary d-flex justify-content-between align-items-center">
                        <div>
                            <span class="h5">${t.symbol}</span> 
                            <span class="ms-2 ${t.side.toLowerCase()}">${t.side}</span>
                        </div>
                        <div class="text-muted">Entry: ${t.entry}</div>
                        <div class="text-info">Target: ${t.tp_2r}</div>
                        <div class="text-warning">LIVE</div>
                    </div>
                `).join('') : '<p class="text-muted text-center py-4">No active trades. AI is hunting...</p>';

            } catch (err) {
                console.error("Dashboard Error:", err);
            }
        }

        // Pulse every 10 seconds to stay updated
        setInterval(updateUI, 10000);
        updateUI();
    </script>
</body>
</html>
